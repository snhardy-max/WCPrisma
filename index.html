<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Wereld vol verhalen – Inschrijven & Presentatiestand</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
<style>
  :root{--green:#1b4b3b;--bg:#f0f5f7;}
  body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg);color:#222;}
  header{background:#fff;border-bottom:1px solid #ddd;position:sticky;top:0;z-index:20;}
  .wrap{max-width:1200px;margin:auto;padding:14px 18px;}
  h1{margin:0;color:var(--green);}
  nav{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap;}
  .navbtn{padding:8px 14px;border-radius:999px;border:1px solid #cfe2da;background:white;cursor:pointer;}
  .navbtn.active{background:var(--green);color:white;}
  .admin-fab{position:fixed;right:18px;bottom:18px;background:var(--green);color:white;border:none;border-radius:999px;padding:12px 16px;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,.3);z-index:9999;}
  .panel{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:10000;}
  .box{background:white;border-radius:12px;padding:20px;width:min(600px,90vw);box-shadow:0 6px 20px rgba(0,0,0,.3);}
  .btn{background:var(--green);color:#fff;border:none;border-radius:8px;padding:8px 14px;cursor:pointer;}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:14px;margin-top:14px;}
  .card{background:white;border:1px solid #e9eef0;border-radius:16px;padding:14px;box-shadow:0 2px 8px rgba(0,0,0,.05);}
  .badge{display:inline-block;padding:4px 10px;border-radius:999px;border:1px dashed #cfe2da;color:#333;font-size:.85rem;margin-bottom:8px;}
  .title{font-weight:700;margin:4px 0;color:#222;}
</style>
</head>
<body>

<header>
  <div class="wrap">
    <h1>Welkom in de wereld vol verhalen</h1>
    <nav>
      <button class="navbtn active" id="navSignup">Inschrijven</button>
      <button class="navbtn" id="navPresentation">Presentatiestand</button>
    </nav>
  </div>
</header>

<main class="wrap" id="signupView">
  <div id="cardsContainer"></div>
</main>

<section id="presentationView" style="display:none;">
  <div class="wrap">
    <h2 id="presTitle" style="color:var(--green)"></h2>
    <div id="presGrid" class="grid"></div>
  </div>
</section>

<!-- ADMIN -->
<button class="admin-fab" id="adminFab">Admin</button>
<div class="panel" id="adminPanel">
  <div class="box">
    <h2>Back-office</h2>
    <p>Wachtwoord: <code>admin</code></p>
    <input type="file" id="importExcelInput" accept=".xlsx,.xls" style="margin-top:8px;">
    <button id="loadExcelBtn" class="btn" style="margin-top:10px;">Laden</button>
    <div id="adminContent" style="margin-top:15px; font-size:0.95rem; color:#333;">Nog geen data geladen.</div>
    <div style="text-align:right;margin-top:20px;">
      <button id="closeAdmin" class="btn">Sluiten</button>
    </div>
  </div>
</div>

<script>
let WORKSHOPS = {};
let uploadedExcel = null;
const STORAGE_KEY = "wvverhalen_workshops_v6";

function normalize(str){
  return str.toLowerCase().replace(/[()]/g,"").replace(/[^a-z0-9]/gi,"").trim();
}

// --- Admin functionaliteit ---
const adminBtn = document.getElementById('adminFab');
const adminPanel = document.getElementById('adminPanel');
const closeAdmin = document.getElementById('closeAdmin');
const excelInput = document.getElementById('importExcelInput');
const loadExcelBtn = document.getElementById('loadExcelBtn');
const adminContent = document.getElementById('adminContent');

adminBtn.onclick = ()=>{
  const pw = prompt("Voer wachtwoord in:");
  if(pw==="admin") adminPanel.style.display="flex";
  else alert("Onjuist wachtwoord.");
};
closeAdmin.onclick = ()=> adminPanel.style.display="none";

excelInput.addEventListener("change", ev=>{
  const file = ev.target.files[0];
  if(file){ uploadedExcel = file; adminContent.textContent = `Bestand geselecteerd: ${file.name}`; }
});

// Parser met tolerante kolomherkenning
loadExcelBtn.addEventListener("click", ()=>{
  if(!uploadedExcel){ alert("Kies eerst een Excel-bestand."); return; }
  const reader = new FileReader();
  reader.onload = (e)=>{
    try {
      const data = new Uint8Array(e.target.result);
      const wb = XLSX.read(data,{type:'array'});
      const result = {};
      wb.SheetNames.forEach(name=>{
        const ws = wb.Sheets[name];
        const rows = XLSX.utils.sheet_to_json(ws,{defval:""});
        rows.forEach(r=>{
          const keys = {};
          for(const k in r){ keys[normalize(k)] = r[k]; }
          const dag = (keys["dag"]||"").toString().trim();
          const tijd = (keys["tijd"]||keys["ronde"]||"").toString().trim();
          const titel = (keys["workshop"]||keys["titel"]||"").toString().trim();
          const begeleider = (keys["begeleider"]||keys["docent"]||"").toString().trim();
          const organisatie = (keys["organisatie"]||keys["bedrijf"]||"").toString().trim();
          const cap = parseInt(keys["capaciteit"]||keys["aantal"]||0);
          const duur = parseInt(keys["duurminuten"]||keys["minuten"]||0);
          if(!titel) return;
          const day = dag.toLowerCase().includes("don") ? "Donderdag" : "Dinsdag";
          const round = tijd.includes("13") ? "13:00" : "11:00";
          if(!result[day]) result[day] = {};
          if(!result[day][round]) result[day][round] = [];
          result[day][round].push({
            title:titel,
            facilitator:begeleider,
            organisation:organisatie,
            capacity:isNaN(cap)?0:cap,
            duration:isNaN(duur)?0:duur
          });
        });
      });
      if(Object.keys(result).length===0) throw new Error("Geen geldige rijen gevonden. Controleer de kolomnamen.");
      WORKSHOPS = result;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(WORKSHOPS));
      adminContent.innerHTML = "✅ Workshops succesvol geladen!";
      renderSignup();
      renderPresentation();
    } catch(err){
      console.error(err);
      alert("❌ Fout bij laden van Excel: " + err.message);
      adminContent.innerHTML = "<span style='color:#b00020'>Fout bij lezen van bestand. Controleer de kolomnamen.</span>";
    }
  };
  reader.readAsArrayBuffer(uploadedExcel);
});

// --- Render functies ---
function renderSignup(){
  const container = document.getElementById("cardsContainer");
  container.innerHTML = "";
  for(const day in WORKSHOPS){
    for(const ronde in WORKSHOPS[day]){
      const lijst = WORKSHOPS[day][ronde];
      const h = document.createElement("h3");
      h.textContent = `${day} – ${ronde}`;
      container.appendChild(h);
      const grid = document.createElement("div");
      grid.className="grid";
      lijst.forEach(w=>{
        const c = document.createElement("div");
        c.className="card";
        c.innerHTML = `
          <div class='badge'>${ronde}</div>
          <div class='title'>${w.title}</div>
          <p>Begeleider: ${w.facilitator||"-"}</p>
          <p>Organisatie: ${w.organisation||"-"}</p>
          <p>Capaciteit: ${w.capacity||0}</p>
          <p>Duur: ${w.duration||0} minuten</p>`;
        grid.appendChild(c);
      });
      container.appendChild(grid);
    }
  }
}

function renderPresentation(){
  const presGrid=document.getElementById('presGrid');
  const presTitle=document.getElementById('presTitle');
  presGrid.innerHTML="";
  for(const day in WORKSHOPS){
    for(const ronde in WORKSHOPS[day]){
      presTitle.textContent=`${day} – ${ronde}`;
      WORKSHOPS[day][ronde].forEach(w=>{
        const c=document.createElement('div');
        c.className='card';
        c.innerHTML=`
          <div class='title'>${w.title}</div>
          <p>Begeleider: ${w.facilitator||"-"}</p>
          <p>Organisatie: ${w.organisation||"-"}</p>
          <p>Capaciteit: ${w.capacity||0}</p>
          <p>Duur: ${w.duration||0} minuten</p>`;
        presGrid.appendChild(c);
      });
      return;
    }
  }
}

// --- Navigatie ---
document.getElementById("navSignup").onclick=()=>{
  document.getElementById("navSignup").classList.add("active");
  document.getElementById("navPresentation").classList.remove("active");
  document.getElementById("signupView").style.display="block";
  document.getElementById("presentationView").style.display="none";
};
document.getElementById("navPresentation").onclick=()=>{
  document.getElementById("navPresentation").classList.add("active");
  document.getElementById("navSignup").classList.remove("active");
  document.getElementById("signupView").style.display="none";
  document.getElementById("presentationView").style.display="block";
  renderPresentation();
};

// --- Herstel opgeslagen data ---
const saved = localStorage.getItem(STORAGE_KEY);
if(saved){ WORKSHOPS = JSON.parse(saved); renderSignup(); }
</script>
</body>
</html>
